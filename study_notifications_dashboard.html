<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Notifications Dashboard</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --container-bg: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
            --card-hover: #f1f5f9;
        }

        [data-theme="dark"] {
            --bg-color: #1a202c;
            --container-bg: #2d3748;
            --text-color: #f7fafc;
            --text-secondary: #a0aec0;
            --border-color: #4a5568;
            --shadow: rgba(0, 0, 0, 0.3);
            --card-hover: #374151;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            box-shadow: 0 20px 40px var(--shadow);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        select, input {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-input {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .export-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .export-btn.json {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }

        .export-btn.json:hover {
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            align-self: end;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--container-bg);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-color);
            box-shadow: 0 4px 12px var(--shadow);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        .studies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .study-card {
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px var(--shadow);
            border-left: 5px solid #667eea;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            color: var(--text-color);
        }

        .study-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow);
            background: var(--card-hover);
        }

        .study-card.selected {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.05);
        }

        .study-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .study-code {
            font-size: 1.1em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .study-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-progress { background: #FFF3CD; color: #856404; }
        .status-transferred { background: #D4EDDA; color: #155724; }
        .status-ready { background: #CCE5FF; color: #004085; }
        .status-dta { background: #F8D7DA; color: #721C24; }
        .status-reactivate { background: #E2E3E5; color: #383D41; }

        .study-description {
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .study-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .meta-icon {
            width: 16px;
            height: 16px;
            opacity: 0.7;
        }

        .notification-preview {
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 25px var(--shadow);
            margin-top: 30px;
            display: none;
        }

        .notification-preview.show {
            display: block;
        }

        .notification-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #FF6B35, #F7931E);
            color: white;
            border-radius: 10px;
        }

        .notification-content {
            display: grid;
            gap: 25px;
        }

        .notification-section {
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .notification-section h3 {
            margin-bottom: 15px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .priority-indicator {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high { background: #FFE6E6; color: #D63384; }
        .priority-medium { background: #FFF3CD; color: #856404; }
        .priority-standard { background: #D4EDDA; color: #155724; }

        .action-required {
            background: rgba(220, 53, 69, 0.1);
            border-left-color: #dc3545;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-weight: 600;
        }

        .dta-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            border: 1px solid #667eea;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .dta-link:hover {
            background: #667eea;
            color: white;
            text-decoration: none;
        }

        .dta-link.missing {
            color: #e74c3c;
            border-color: #e74c3c;
        }

        .dta-link.missing:hover {
            background: #e74c3c;
            color: white;
        }

        .file-status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .file-status-indicator.available {
            background: #27ae60;
        }

        .file-status-indicator.missing {
            background: #e74c3c;
        }

        .file-status-indicator.placeholder {
            background: #f39c12;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .studies-grid {
                grid-template-columns: 1fr;
            }
            
            .study-meta {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>üìä Study Notifications Dashboard</h1>
            <p>Generate customized DTA notifications for research studies</p>
        </div>

        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-number" id="totalStudies">0</div>
                <div class="stat-label">Total Studies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="rp1Count">0</div>
                <div class="stat-label">RP1 Studies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="rp2Count">0</div>
                <div class="stat-label">RP2 Studies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="selectedCount">0</div>
                <div class="stat-label">Selected</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="searchInput">üîç Search Studies</label>
                <input type="text" id="searchInput" class="search-input" placeholder="Search by code, title, country, or organization...">
            </div>
            <div class="control-group">
                <label for="countryFilter">Filter by Country</label>
                <select id="countryFilter">
                    <option value="">All Countries</option>
                </select>
            </div>
            <div class="control-group">
                <label for="statusFilter">Filter by Status</label>
                <select id="statusFilter">
                    <option value="">All Statuses</option>
                </select>
            </div>
            <div class="control-group">
                <label for="rpFilter">Filter by RP</label>
                <select id="rpFilter">
                    <option value="">All Studies</option>
                    <option value="RP1">RP1 Studies</option>
                    <option value="RP2">RP2 Studies</option>
                </select>
            </div>
            <div class="export-buttons">
                <button class="export-btn json" onclick="exportJson()">JSON</button>
                <button class="export-btn csv" onclick="exportCsv()">CSV</button>
            </div>
            <button class="generate-btn" onclick="generateNotification()">
                üîî Generate Notification
            </button>
        </div>

        <div class="studies-grid" id="studiesGrid">
            <!-- Studies will be populated here -->
        </div>

        <div class="notification-preview" id="notificationPreview">
            <div class="notification-header">
                <h2>üìß DTA Cloud Migration Notification</h2>
                <p>Ready for distribution to study contacts</p>
            </div>
            <div class="notification-content" id="notificationContent">
                <!-- Notification content will be generated here -->
            </div>
            <button class="copy-btn" onclick="copyNotification()">
                üìã Copy Notification Text
            </button>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()">üåô Toggle Dark Mode</button>
    </div>

    <script>
        // DTA File Mappings - linking study codes to their respective files
        const dtaFileMappings = {
            "BWA072": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/2410710-01.DTA_HEAT001_v2.0_WHC_BWA072_FE.pdf",
            "CAP088": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/DTA_2402820-01.CM_CAP088_SAHAPS_CAPRISA_WITS_FE 15 Apr 2024.pdf",
            "DID261": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/DID261_[filename_TBD].pdf",
            "EAT001": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/EAT001_[multiple_files].pdf",
            "ETH501": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/DTA_WHC_ETH501_signed.pdf",
            "ETH553": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/24033800-01.CM - ETH553_FE.pdf",
            "ETH563": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_drafts_WHC/DTA_HEAT001_V2.0_WHC_ETH563.docx",
            "ETH570": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/ETH570_DTA_Maternal Alcohol consumption_Dr Alemu_signed.pdf",
            "GHA020": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_final_UCT/FE DTA-2025-0264 UCD - Cape Town Univ. DTA_HEAT001_v2.0_UCT_38344_GHA020.pdf",
            "KEN086": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_UCT35447_KEN086_DUA_Standard_Template_v1.5 (1) LvA Edited 16.03.2023_signature.pdf",
            "KEN531": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/KEN531_6839_6716_124 DTA_Template_HEAT001_v2.0_WHC_UABComments021925 _FE.pdf",
            "KEN539": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/UT35438_DTA PAI-HEAT_KEN539_MomCare study_For Signature - signed.pdf",
            "MUL090": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/HDID26143KR24 FE WHC_DTAv2_MUL090_2504370-01.CM.pdf",
            "MUL159": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/230502_MUL159_IMPAACT SDUA Signed WHC.pdf",
            "MUL352": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_drafts_WHC/DTA_Template_HEAT001_v2.0_WHC_MUL352.docx",
            "MWI021": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_DTA_HEAT001_UCT35523_MWI021_MWI026_2023-05-16.pdf",
            "MWI026": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_DTA_HEAT001_UCT35523_MWI021_MWI026_2023-05-16.pdf",
            "MWI049": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_DTA_HEAT001_UCT35523_MWI049_2023-05-15.pdf",
            "MWI064": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/DTA_HEAT001_UCT35664-MWI064-MWI534_20230329_v1_Final.pdf",
            "MWI088": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_UCT35372_CDC_DUA_MWI088_15.02.2023-1AK CLEAN_23.03.2023_AK.pdf",
            "MWI094": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/MWI094 PRIME_DTA_NHI-Individual participation Agreement_201223.pdf",
            "MWI097": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/MWI097_WHC_PURE Study DTA Signed.pdf",
            "MWI152": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_UCT35524_DTA_HEAT001_UCT35524-MWI152_10.05.2024.docx.pdf",
            "MWI198": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/23071200_MWI198 and MWI524_DTA_POISE and PEPI with JHU_signed.pdf",
            "MWI524": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/23071200_MWI198 and MWI524_DTA_POISE and PEPI with JHU_signed.pdf",
            "MWI534": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/DTA_HEAT001_UCT35664-MWI064-MWI534_20230329_v1_Final.pdf",
            "NGA547": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_drafts_WHC/DTA_NGA547_WHC TEMPLATE-UI and WITTS.docx",
            "NGA548": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/9328_1551_DTA_HEAT001LEGAL signature_AGREEMENT_NGA548 28 6 24 EvW.pdf",
            "SLE054": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/FE_DUA_with_WHC_SLE054 final.pdf",
            "TZA079": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/FE_01212025_Agreement_for_DUA24-0995_Wits_Duggan_TZA079_TZA080.pdf",
            "TZA080": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/FE_01212025_Agreement_for_DUA24-0995_Wits_Duggan_TZA079_TZA080.pdf",
            "TZA380": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/UCT37159_UCT Signed_DTA_NIMR_TZA380.pdf",
            "TZA556": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_DATA TRANSFER AGREEMENT_05042023_TZA556.pdf",
            "UCT353": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/UCT353_[filename_TBD].pdf",
            "UCT354": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/UCT354_[filename_TBD].pdf",
            "UCT355": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/UCT355_[filename_TBD].pdf",
            "UCT356": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/UCT356_[filename_TBD].pdf",
            "UCT371": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/UCT371_[filename_TBD].pdf",
            "UCT381": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/UCT381_[filename_TBD].pdf",
            "UCT395": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_final_UCT/UCT395_[filename_TBD].pdf",
            "ZAF014": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_DTA_HEAT001_UCT35526-ZAF014_20230329_v1_UP Signed.pdf",
            "ZAF055": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/DTA_HEAT001_UCT35525-ZAF055_20230328_FE.pdf",
            "ZAF106": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/23101700-01.DSA-VIDA studies_INCL ZAF106_WHC1_signed.pdf",
            "ZAF124": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/ZAF124_Stellenbosch_WHC_Safe Passage DTA signed.pdf",
            "ZAF145": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_drafts_WHC/20250430 S009731 DTA_Template_HEAT001_v2.0_WHC_ZAF145.docx",
            "ZAF162": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/UCT39528_UCT studies_ZAF162_ZAF504_ZAF517_ZAF544_FE.pdf",
            "ZAF163": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/DTA_2402820-01.CM_CAP088_SAHAPS_CAPRISA_WITS_FE 15 Apr 2024_ZAF163.pdf",
            "ZAF192": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_12781 DTA_HEAT001_UCT35366-ZAF192_20230328_v1.pdf",
            "ZAF357": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_DTA_HEAT001_20230328_UCT35599_ZAF357_ZAF358.pdf",
            "ZAF358": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_through_UCT/FE_DTA_HEAT001_20230328_UCT35599_ZAF357_ZAF358.pdf",
            "ZAF504": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/UCT39528_UCT studies_ZAF162_ZAF504_ZAF517_ZAF544_FE.pdf",
            "ZAF517": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/UCT39528_UCT studies_ZAF162_ZAF504_ZAF517_ZAF544_FE.pdf",
            "ZAF544": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_fully executed_WHC/UCT39528_UCT studies_ZAF162_ZAF504_ZAF517_ZAF544_FE.pdf",
            "ZAF600": "/Users/craig/Downloads/Executed DTA's-selected/DTAs_though_WHC/2402810-01.DTA_ZAF600.pdf",
            "ZMB137": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_final_UCT/FE_UCT39547_25-0842 UNC_UCT_ZMB137 ZAPPS.pdf",
            "ZMB173": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_final_UCT/ZMB173_UCT39547_25-0842+UNC_UCT_FE.pdf",
            "ZMB530": "/Users/craig/Downloads/Executed DTA's-selected/New DTAs_final_UCT/ZMB530_Hamer_BU_UNIVERSITY OF CAPE TOWN_DTA_Template_HEAT001_FE.pdf"
        };

        // Function to derive DTA metadata from folder path
        function getDtaMetadataFromPath(filePath) {
            if (!filePath) return { template: 'N/A', recipient: 'N/A', status: 'N/A' };
            
            // Extract folder name from path
            const pathParts = filePath.split('/');
            const folderName = pathParts[pathParts.length - 2]; // Get the folder name
            
            let template, recipient, status;
            
            if (folderName.includes('DTAs_though_WHC')) {
                template = 'old';
                recipient = 'WHC';
                status = 'executed';
            } else if (folderName.includes('DTAs_through_UCT')) {
                template = 'old';
                recipient = 'UCT';
                status = 'executed';
            } else if (folderName.includes('New DTAs_drafts_WHC')) {
                template = 'new';
                recipient = 'WHC';
                status = 'draft';
            } else if (folderName.includes('New DTAs_final_UCT')) {
                template = 'new';
                recipient = 'UCT';
                status = 'final';
            } else if (folderName.includes('New DTAs_fully executed_WHC')) {
                template = 'new';
                recipient = 'WHC';
                status = 'fully_executed';
            } else {
                template = 'N/A';
                recipient = 'N/A';
                status = 'N/A';
            }
            
            return { template, recipient, status };
        }

        // Function to show DTA file information
        function showDtaFileInfo(studyCode) {
            const filePath = dtaFileMappings[studyCode];
            if (filePath) {
                const fileName = filePath.split('/').pop();
                const metadata = getDtaMetadataFromPath(filePath);
                
                alert(`DTA File Information for ${studyCode}:

üìÅ Folder: ${filePath.split('/').slice(-2, -1)[0]}
üìÑ File: ${fileName}
üìã Template: ${metadata.template.toUpperCase()}
üèõÔ∏è Recipient: ${metadata.recipient}
üìë Status: ${metadata.status.replace('_', ' ').toUpperCase()}

üìç Full Path: ${filePath}

Note: To open this file, navigate to the path above on your local machine.`);
            } else {
                alert(`No DTA file mapped for study ${studyCode}`);
            }
        }

        // Combined study data from RP1 and RP2 files
        const studyData = {
            rp1: [
                // Botswana
                {
                    code: "BWA072",
                    title: "Study to Improve Survival Among HIV-Exposed Infants in Botswana - The Mpepu Study",
                    country: "Botswana",
                    status: "Transfer of Data in progress (UCT)",
                    type: "RP1",
                    sample_size: "3334",
                    organization: "UCT",
                    priority: "High",
                    contact: "gajibola@bhp.org.bw"
                },
                // Ethiopia
                {
                    code: "ETH553",
                    title: "Adverse maternal outcomes of adolescent pregnancy in Northwest Ethiopia: A prospective cohort study",
                    country: "Ethiopia",
                    status: "Transfer of Data in progress (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard",
                    contact: "gechm2005@gmail.com"
                },
                {
                    code: "ETH563",
                    title: "Incidence of preterm premature rupture of membranes and inter-pregnancy interval studies",
                    country: "Ethiopia",
                    status: "Data transferred to UCT",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ETH570",
                    title: "Effects of maternal alcohol consumption during pregnancy on adverse fetal outcomes",
                    country: "Ethiopia",
                    status: "Recheck eligibility after looking at the data (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium"
                },
                {
                    code: "ETH501",
                    title: "Maternal and Newborn Health in Ethiopia Partnership project",
                    country: "Ethiopia",
                    status: "DTA completed through Wits",
                    type: "RP1",
                    organization: "Wits",
                    priority: "Standard",
                    contact: "yirgurob@gmail.com"
                },
                // Ghana
                {
                    code: "GHA020",
                    title: "Efficacy of Lipid-Based Nutrient Supplements (LNS) for Pregnant and Lactating Women - iLiNS-DYAD",
                    country: "Ghana",
                    status: "Data transferred to UCT",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "GHA075",
                    title: "Enhanced AnteNatal Care service package for Malaria and Anaemia in Pregnancy EANC-MAP",
                    country: "Ghana",
                    status: "Entering into DTA (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium"
                },
                // Kenya
                {
                    code: "KEN086",
                    title: "STOPMIP Kenya",
                    country: "Kenya",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "Wits",
                    priority: "Standard"
                },
                {
                    code: "KEN539",
                    title: "MomCare Project",
                    country: "Kenya",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "Wits",
                    priority: "Standard"
                },
                {
                    code: "KEN531",
                    title: "Testing Strategies for Couple Engagement in PMTCT and Family Health (Jamii Bora)",
                    country: "Kenya",
                    status: "Entering into DTA (Wits)",
                    type: "RP1",
                    organization: "Wits",
                    priority: "High"
                },
                {
                    code: "KEN030",
                    title: "PRIMA - PrEP Implementation for Mothers in Antenatal Care",
                    country: "Kenya",
                    status: "Entering into DTA (Wits)",
                    type: "RP1",
                    organization: "Wits",
                    priority: "High",
                    contact: "gjohn@uw.edu"
                },
                {
                    code: "KEN136",
                    title: "Mama Salama",
                    country: "Kenya",
                    status: "Entering into DTA (Wits)",
                    type: "RP1",
                    organization: "Wits",
                    priority: "Medium",
                    contact: "gjohn@uw.edu"
                },
                // Malawi
                {
                    code: "MWI152",
                    title: "Pregnancy intentions",
                    country: "Malawi",
                    status: "Data transferred to UCT",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MWI064",
                    title: "PASTAL",
                    country: "Malawi",
                    status: "Recheck eligibility after looking at the data (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium"
                },
                {
                    code: "MWI532",
                    title: "APPLe",
                    country: "Malawi",
                    status: "Recheck eligibility after looking at the data (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium"
                },
                {
                    code: "MWI534",
                    title: "ANC/FRS",
                    country: "Malawi",
                    status: "Recheck eligibility after looking at the data (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium"
                },
                {
                    code: "MWI021",
                    title: "iLiNS-DYAD M",
                    country: "Malawi",
                    status: "harmonization coding check",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MWI086",
                    title: "STOPMIP Malawi",
                    country: "Malawi",
                    status: "harmonization coding check",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MWI026",
                    title: "LAIS",
                    country: "Malawi",
                    status: "harmonization coding check",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MWI198",
                    title: "PEPI",
                    country: "Malawi",
                    status: "harmonization coding check",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MWI097",
                    title: "The PURE Study",
                    country: "Malawi",
                    status: "problem with geolocation",
                    type: "RP1",
                    organization: "UCT",
                    priority: "High"
                },
                {
                    code: "MWI088",
                    title: "BAN",
                    country: "Malawi",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MWI524",
                    title: "POISE",
                    country: "Malawi",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MWI094",
                    title: "PRIME",
                    country: "Malawi",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MWI049",
                    title: "Interventions for Moderate Malnutrition in Pregnancy (Mamachiponde)",
                    country: "Malawi",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                // Multicountry
                {
                    code: "MUL159",
                    title: "Promoting Maternal and Infant Survival Everywhere (PROMISE) Protocol. PROMISE 1077BF",
                    country: "Multicountry",
                    status: "health check",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium"
                },
                {
                    code: "MUL140",
                    title: "PREGACT",
                    country: "Multicountry",
                    status: "harmonization coding check",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MUL006",
                    title: "COSMIC",
                    country: "Multicountry",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "MUL090",
                    title: "PROMISE EBF - Safety and Efficacy of Exclusive Breastfeeding Promotion",
                    country: "Multicountry",
                    status: "Linking email sent",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Standard",
                    contact: "Tanya.Doherty@mrc.ac.za"
                },
                // Nigeria
                {
                    code: "NGA548",
                    title: "Prevalence, seroconversion and mother-to-child transmission of dual and triplex infections",
                    country: "Nigeria",
                    status: "Linking email sent",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Standard"
                },
                {
                    code: "NGA547",
                    title: "Ibadan Pregnancy Cohort Study",
                    country: "Nigeria",
                    status: "Entering into DTA (Wits)",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Standard",
                    contact: "adeoyeikeola@yahoo.com",
                    sample_size: "1745"
                },
                // Sierra Leone
                {
                    code: "SLE054",
                    title: "Nutritional and Anti-infective Interventions for Malnutrition in Pregnancy (Beleuman Welbodi)",
                    country: "Sierra Leone",
                    status: "Linking email sent",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Standard",
                    contact: "manarymj@wustl.edu"
                },
                // South Africa
                {
                    code: "ZAF581",
                    title: "CAP088",
                    country: "South Africa",
                    status: "Pre-processing (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ZAF155",
                    title: "COHORTS Birth to 20",
                    country: "South Africa",
                    status: "Data transferred to UCT",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ZAF192",
                    title: "Goodstart",
                    country: "South Africa",
                    status: "Processed for mapping (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ZAF014",
                    title: "GDM",
                    country: "South Africa",
                    status: "harmonization coding check",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ZAF358",
                    title: "Low HIV incidence in pregnant and postpartum women receiving community-based prevention",
                    country: "South Africa",
                    status: "harmonization coding check",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ZAF357",
                    title: "Effectiveness of community-based support for pregnant women living with HIV",
                    country: "South Africa",
                    status: "harmonization coding check",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ZAF124",
                    title: "The Safe Passage Study",
                    country: "South Africa",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ZAF600",
                    title: "Healthy Mother Healthy Baby Programme",
                    country: "South Africa",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ZAF055",
                    title: "PMTCT South African couples",
                    country: "South Africa",
                    status: "Dataset ready for analysis",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                {
                    code: "ZAF145",
                    title: "Philani study",
                    country: "South Africa",
                    status: "Entering into DTA (Wits)",
                    type: "RP1",
                    organization: "Wits",
                    priority: "Medium",
                    contact: "markt@sun.ac.za"
                },
                {
                    code: "ZAF515",
                    title: "MACE - Mother and Child in the Environment birth cohort",
                    country: "South Africa",
                    status: "Entering into DTA (Wits)",
                    type: "RP1",
                    organization: "Wits",
                    priority: "Medium",
                    contact: "naidoon@ukzn.ac.za"
                },
                {
                    code: "ZAF007",
                    title: "DCHS - Drakenstein Child Health Study",
                    country: "South Africa",
                    status: "DTA being processed through WITS",
                    type: "RP1",
                    organization: "Wits",
                    priority: "Standard",
                    contact: "heather.zar@uct.ac.za"
                },
                {
                    code: "ZAF106",
                    title: "MATFLU - Influenza Vaccine Trial in HIV Uninfected Pregnant Women",
                    country: "South Africa",
                    status: "Linking email sent",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Standard",
                    contact: "catherine.hill@wits-vida.org"
                },
                {
                    code: "ZAF517",
                    title: "PIMS - Prematurity Immunology in HIV-infected Mothers and their infants Study",
                    country: "South Africa",
                    status: "Linking email sent",
                    type: "RP1",
                    organization: "WHC-UCT",
                    priority: "Standard",
                    contact: "landon.myer@uct.ac.za"
                },
                // Tanzania
                {
                    code: "TZA380",
                    title: "Medication exposure during pregnancy: pilot pharmacovigilance system",
                    country: "Tanzania",
                    status: "DTA with Jessica (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Standard"
                },
                // Uganda
                {
                    code: "UGA077",
                    title: "Uganda Peripartum Infection and Mortality UPIM study",
                    country: "Uganda",
                    status: "DTA with Jessica (UCT)",
                    type: "RP1",
                    sample_size: "4231",
                    organization: "UCT",
                    priority: "High",
                    contact: "jngonzi@must.ac.ug"
                },
                // Zambia
                {
                    code: "ZMB343",
                    title: "Epidemiology of malaria and curable STIs/RTIs among pregnant women",
                    country: "Zambia",
                    status: "DTA with Jessica (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "High",
                    sample_size: "1086"
                },
                {
                    code: "ZMB174",
                    title: "Zambia Chlorhexidine Application Trial (ZamCAT)",
                    country: "Zambia",
                    status: "Transfer of Data in progress (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "High",
                    sample_size: "39679"
                },
                {
                    code: "ZMB137",
                    title: "ZAPPS - Zambian Preterm Birth Prevention Study",
                    country: "Zambia",
                    status: "Transfer of Data in progress (UCT)",
                    type: "RP1",
                    organization: "UCT",
                    priority: "High",
                    sample_size: "1450"
                },
                {
                    code: "DID261",
                    title: "DID261 - Research Study",
                    country: "Unknown",
                    status: "DTA Available",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "WHC",
                    dta_status: "fully_executed"
                },
                {
                    code: "EAT001",
                    title: "EAT001 - Research Study",
                    country: "Unknown",
                    status: "DTA Available",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "WHC",
                    dta_status: "fully_executed"
                },
                {
                    code: "MUL352",
                    title: "MUL352 - Multi-site Study",
                    country: "Multi-country",
                    status: "Draft DTA",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "WHC",
                    dta_status: "draft"
                },
                {
                    code: "TZA079",
                    title: "TZA079 - Tanzania Study",
                    country: "Tanzania",
                    status: "DTA Executed",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "WHC",
                    dta_status: "fully_executed"
                },
                {
                    code: "TZA080",
                    title: "TZA080 - Tanzania Study",
                    country: "Tanzania",
                    status: "DTA Executed",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "WHC",
                    dta_status: "fully_executed"
                },
                {
                    code: "TZA556",
                    title: "TZA556 - Tanzania Study",
                    country: "Tanzania",
                    status: "DTA through UCT",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "old",
                    main_recipient: "UCT",
                    dta_status: "executed"
                },
                {
                    code: "UCT353",
                    title: "UCT353 - UCT Study",
                    country: "South Africa",
                    status: "DTA Available",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "old",
                    main_recipient: "UCT",
                    dta_status: "executed"
                },
                {
                    code: "UCT354",
                    title: "UCT354 - UCT Study",
                    country: "South Africa",
                    status: "DTA Available",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "old",
                    main_recipient: "UCT",
                    dta_status: "executed"
                },
                {
                    code: "UCT355",
                    title: "UCT355 - UCT Study",
                    country: "South Africa",
                    status: "DTA Available",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "old",
                    main_recipient: "UCT",
                    dta_status: "executed"
                },
                {
                    code: "UCT356",
                    title: "UCT356 - UCT Study",
                    country: "South Africa",
                    status: "DTA Available",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "old",
                    main_recipient: "UCT",
                    dta_status: "executed"
                },
                {
                    code: "UCT371",
                    title: "UCT371 - UCT Study",
                    country: "South Africa",
                    status: "DTA Available",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "old",
                    main_recipient: "UCT",
                    dta_status: "executed"
                },
                {
                    code: "UCT381",
                    title: "UCT381 - UCT Study",
                    country: "South Africa",
                    status: "DTA Available",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "old",
                    main_recipient: "UCT",
                    dta_status: "executed"
                },
                {
                    code: "ZAF162",
                    title: "ZAF162 - South Africa Study",
                    country: "South Africa",
                    status: "DTA Executed",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "WHC",
                    dta_status: "fully_executed"
                },
                {
                    code: "ZAF163",
                    title: "ZAF163 - South Africa Study",
                    country: "South Africa",
                    status: "DTA though WHC",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "old",
                    main_recipient: "WHC",
                    dta_status: "executed"
                },
                {
                    code: "ZAF504",
                    title: "ZAF504 - South Africa Study",
                    country: "South Africa",
                    status: "DTA Executed",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "WHC",
                    dta_status: "fully_executed"
                },
                {
                    code: "ZAF544",
                    title: "ZAF544 - South Africa Study",
                    country: "South Africa",
                    status: "DTA Executed",
                    type: "RP1",
                    organization: "WHC",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "WHC",
                    dta_status: "fully_executed"
                },
                {
                    code: "ZMB173",
                    title: "ZMB173 - Zambia Study",
                    country: "Zambia",
                    status: "Final DTA",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "UCT",
                    dta_status: "final"
                },
                {
                    code: "ZMB530",
                    title: "ZMB530 - Zambia Study",
                    country: "Zambia",
                    status: "Final DTA",
                    type: "RP1",
                    organization: "UCT",
                    priority: "Medium",
                    sample_size: "TBD",
                    dta_template: "new",
                    main_recipient: "UCT",
                    dta_status: "final"
                }
            ],
            rp2: [
                // All RP2 studies are South Africa based (Johannesburg sites)
                {
                    code: "JHB_WCRBara_36_CAPSTONE2",
                    title: "CAPSTONE2 - Baloxavir marboxil efficacy study",
                    country: "South Africa",
                    status: "declined participation",
                    type: "RP2",
                    organization: "Boehringer-Ingelheim",
                    priority: "Standard",
                    nct: "NCT02949011",
                    sample_size: "278"
                },
                {
                    code: "JHB_MTN-SCHARP_012_CHARISMA",
                    title: "CHARISMA - Community Health clinic model for Agency in Relationships",
                    country: "South Africa",
                    status: "declined participation",
                    type: "RP2",
                    organization: "WitsRHI",
                    priority: "Standard",
                    nct: "NCT04092114",
                    sample_size: "407"
                },
                {
                    code: "JHB_NHLS_38_Boston",
                    title: "Boston Hero Group Database Platform",
                    country: "South Africa",
                    status: "Data currently unavailable",
                    type: "RP2",
                    organization: "NHLS",
                    priority: "Standard"
                },
                {
                    code: "JHB_PHRU_46_ENSEMBLE_COV2.S",
                    title: "ENSEMBLE COV2.S - COVID-19 vaccine trial",
                    country: "South Africa",
                    status: "Data currently unavailable",
                    type: "RP2",
                    organization: "PHRU",
                    priority: "Medium",
                    nct: "NCT04505722",
                    sample_size: "44325"
                },
                {
                    code: "JHB_PHRU_48_PHOENIx_MDRTB",
                    title: "PHOENIx - Multi-drug Resistant TB Study",
                    country: "South Africa",
                    status: "Data currently unavailable",
                    type: "RP2",
                    organization: "PHRU",
                    priority: "Standard"
                },
                {
                    code: "JHB_WitsRHI_49_RECOVERY_COVID19",
                    title: "RECOVERY - COVID-19 Treatment Study",
                    country: "South Africa",
                    status: "Data currently unavailable",
                    type: "RP2",
                    organization: "WitsRHI",
                    priority: "Standard",
                    sample_size: "50000"
                },
                {
                    code: "JHB_WRHI_39_HPTN084",
                    title: "HPTN 084 - HIV Prevention Study",
                    country: "South Africa",
                    status: "Data currently unavailable",
                    type: "RP2",
                    organization: "WitsRHI",
                    priority: "High",
                    nct: "NCT03164564",
                    sample_size: "382"
                },
                {
                    code: "JHB_WRHI_Soweto_40_HPTN052",
                    title: "HPTN052 - HIV Treatment as Prevention",
                    country: "South Africa",
                    status: "Data currently unavailable",
                    type: "RP2",
                    organization: "WitsRHI",
                    priority: "Standard"
                },
                {
                    code: "JHB_VIDA_50_PertussisVax_HIV_PregnantWomen",
                    title: "Pertussis vaccination among HIV-infected and HIV-uninfected pregnant women",
                    country: "South Africa",
                    status: "Reactivate",
                    type: "RP2",
                    organization: "VIDA",
                    priority: "High",
                    nct: "NCT05264662",
                    contact: "marta.nunes@wits-vida.org"
                },
                {
                    code: "JHB_WCR_38_SPECTRA",
                    title: "SPECTRA - COVID-19 Prevention Vaccine Study",
                    country: "South Africa",
                    status: "Reactivate",
                    type: "RP2",
                    organization: "VIDA/Clover",
                    priority: "Standard",
                    nct: "NCT04672395",
                    sample_size: "31454"
                },
                {
                    code: "JHB_CHRU_23_SOLIDARITY",
                    title: "SOLIDARITY - COVID-19 Clinical Trial",
                    country: "South Africa",
                    status: "Reactivate",
                    type: "RP2",
                    organization: "CHRU",
                    priority: "Standard",
                    contact: "mrassool@witshealth.co.za"
                },
                {
                    code: "JHB_CHRU_30_REMoxTB_ACTGA5349",
                    title: "REMoxTB - Moxifloxacin TB Treatment Study",
                    country: "South Africa",
                    status: "Reactivate",
                    type: "RP2",
                    organization: "CHRU",
                    priority: "Standard",
                    nct: "NCT00864383",
                    sample_size: "1931"
                },
                {
                    code: "JHB_Ezin_43_RCT_COVID_Ribavirin_Nitazoxanide",
                    title: "COVID-19 Ribavirin and Nitazoxanide Treatment Study",
                    country: "South Africa",
                    status: "Reactivate",
                    type: "RP2",
                    organization: "Ezintsha",
                    priority: "Standard",
                    nct: "NCT04563208",
                    sample_size: "80"
                },
                {
                    code: "JHB_PHRU_35_HVTN705_HPX2008",
                    title: "HVTN 705/HPX2008 - HIV Prevention Vaccine Study",
                    country: "South Africa",
                    status: "Reactivate",
                    type: "RP2",
                    organization: "SCHARP_HVTN",
                    priority: "Standard",
                    nct: "NCT03060629",
                    sample_size: "200"
                },
                {
                    code: "JHB_PHRU_41_CoVPN3008_PF_Soweto",
                    title: "CoVPN3008 - Pfizer COVID-19 Study",
                    country: "South Africa",
                    status: "Reactivate",
                    type: "RP2",
                    organization: "PHRU",
                    priority: "Standard",
                    nct: "NCT05168813"
                }
            ]
        };

        let allStudies = [...studyData.rp1, ...studyData.rp2];
        let selectedStudies = [];
        let filteredStudies = allStudies;

        function initializeDashboard() {
            populateFilters();
            updateStats();
            renderStudies();
        }

        function populateFilters() {
            const countries = [...new Set(allStudies.map(s => s.country))].sort();
            const statuses = [...new Set(allStudies.map(s => s.status))].sort();

            const countrySelect = document.getElementById('countryFilter');
            const statusSelect = document.getElementById('statusFilter');

            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
            });

            statuses.forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                statusSelect.appendChild(option);
            });

            // Add event listeners
            countrySelect.addEventListener('change', applyFilters);
            statusSelect.addEventListener('change', applyFilters);
            document.getElementById('rpFilter').addEventListener('change', applyFilters);
            document.getElementById('searchInput').addEventListener('input', applyFilters);
        }

        function applyFilters() {
            const countryFilter = document.getElementById('countryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const rpFilter = document.getElementById('rpFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            filteredStudies = allStudies.filter(study => {
                return (!countryFilter || study.country === countryFilter) &&
                       (!statusFilter || study.status === statusFilter) &&
                       (!rpFilter || study.type === rpFilter) &&
                       (study.code.toLowerCase().includes(searchQuery) ||
                        study.title.toLowerCase().includes(searchQuery) ||
                        study.country.toLowerCase().includes(searchQuery) ||
                        study.organization.toLowerCase().includes(searchQuery));
            });

            renderStudies();
            updateStats();
        }

        function updateStats() {
            document.getElementById('totalStudies').textContent = allStudies.length;
            document.getElementById('rp1Count').textContent = studyData.rp1.length;
            document.getElementById('rp2Count').textContent = studyData.rp2.length;
            document.getElementById('selectedCount').textContent = selectedStudies.length;
        }

        function renderStudies() {
            const grid = document.getElementById('studiesGrid');
            grid.innerHTML = '';

            filteredStudies.forEach(study => {
                const card = createStudyCard(study);
                grid.appendChild(card);
            });
        }

        function createStudyCard(study) {
            const card = document.createElement('div');
            card.className = `study-card ${selectedStudies.includes(study.code) ? 'selected' : ''}`;
            card.onclick = () => toggleStudySelection(study.code);

            const statusClass = getStatusClass(study.status);
            const priorityClass = getPriorityClass(study.priority);

            // Check if DTA file exists and determine status
            const dtaFilePath = dtaFileMappings[study.code];
            let fileStatus = 'missing';
            let linkClass = 'dta-link missing';
            let linkText = 'No DTA File';
            
            // Get metadata from folder structure (this overrides any hardcoded values)
            let dtaMetadata = { template: 'N/A', recipient: 'N/A', status: 'N/A' };
            
            if (dtaFilePath) {
                if (dtaFilePath.includes('[filename_TBD]') || dtaFilePath.includes('[multiple_files]')) {
                    fileStatus = 'placeholder';
                    linkClass = 'dta-link missing';
                    linkText = 'File TBD';
                    // Still get metadata from folder even for placeholder files
                    dtaMetadata = getDtaMetadataFromPath(dtaFilePath);
                } else {
                    fileStatus = 'available';
                    linkClass = 'dta-link';
                    linkText = 'View DTA Info';
                    // Get actual metadata from folder structure
                    dtaMetadata = getDtaMetadataFromPath(dtaFilePath);
                }
            }

            card.innerHTML = `
                <div class="study-header">
                    <div>
                        <div class="study-code">${study.code}</div>
                        <div class="study-status ${statusClass}">${study.status}</div>
                    </div>
                    <div class="study-priority ${priorityClass}">${study.priority}</div>
                </div>
                <div class="study-description">${study.title}</div>
                <div class="study-meta">
                    <div class="meta-item">
                        <span>üåç</span>
                        <span>${study.country}</span>
                    </div>
                    <div class="meta-item">
                        <span>üè¢</span>
                        <span>${study.organization}</span>
                    </div>
                    <div class="meta-item">
                        <span>üìä</span>
                        <span>${study.sample_size || 'N/A'} participants</span>
                    </div>
                    <div class="meta-item">
                        <span>üìÅ</span>
                        <span>${study.type}</span>
                    </div>
                    <div class="meta-item">
                        <span>üìÑ</span>
                        <span>
                            <span class="file-status-indicator ${fileStatus}"></span>
                            <a href="#" class="${linkClass}" onclick="event.stopPropagation(); ${fileStatus === 'available' ? `showDtaFileInfo('${study.code}')` : `alert('DTA file not available for ${study.code}')`}; return false;">${linkText}</a>
                        </span>
                    </div>
                    <div class="meta-item">
                        <span>üìã</span>
                        <span>Template: ${dtaMetadata.template.toUpperCase()}</span>
                    </div>
                    <div class="meta-item">
                        <span>üèõÔ∏è</span>
                        <span>Recipient: ${dtaMetadata.recipient}</span>
                    </div>
                    <div class="meta-item">
                        <span>üìë</span>
                        <span>DTA Status: ${dtaMetadata.status.replace('_', ' ').toUpperCase()}</span>
                    </div>
                </div>
            `;

            return card;
        }

        function getStatusClass(status) {
            if (status.includes('progress')) return 'status-progress';
            if (status.includes('transferred')) return 'status-transferred';
            if (status.includes('ready')) return 'status-ready';
            if (status.includes('DTA')) return 'status-dta';
            if (status.includes('Reactivate')) return 'status-reactivate';
            return 'status-progress';
        }

        function getPriorityClass(priority) {
            switch(priority?.toLowerCase()) {
                case 'high': return 'priority-high';
                case 'medium': return 'priority-medium';
                default: return 'priority-standard';
            }
        }

        function toggleStudySelection(code) {
            if (selectedStudies.includes(code)) {
                selectedStudies = selectedStudies.filter(c => c !== code);
            } else {
                selectedStudies.push(code);
            }
            renderStudies();
            updateStats();
        }

        function generateNotification() {
            if (selectedStudies.length === 0) {
                alert('Please select at least one study to generate a notification.');
                return;
            }

            const selectedStudyData = allStudies.filter(s => selectedStudies.includes(s.code));
            const notificationContent = createNotificationContent(selectedStudyData);
            
            document.getElementById('notificationContent').innerHTML = notificationContent;
            document.getElementById('notificationPreview').classList.add('show');
            
            // Scroll to notification
            document.getElementById('notificationPreview').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        function createNotificationContent(studies) {
            const currentDate = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            let content = '';

            studies.forEach((study, index) => {
                const deadline = new Date();
                deadline.setDate(deadline.getDate() + 5);
                const deadlineStr = deadline.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });

                content += `
                    <div class="notification-section">
                        <h3>üìã Study Information - ${study.code}</h3>
                        <div class="study-stats">N = ${study.sample_size || 'TBD'}</div>
                        <div class="study-stats">Country: ${study.country}</div>
                        <div class="study-stats">DTA Type: DTA_v2</div>
                        <div class="study-stats">Recipient: ${study.organization}</div>
                        <p><strong>Study Title:</strong> ${study.title}</p>
                    </div>

                    <div class="notification-section">
                        <h3>üë• Contact Information</h3>
                        <p><strong>Primary Contact:</strong> ${study.contact || 'TBD'}<br>
                        <strong>Institution:</strong> ${study.organization}<br>
                        <strong>Study Code:</strong> ${study.code}</p>
                    </div>

                    <div class="notification-section">
                        <h3>‚öñÔ∏è Legal Compliance Requirements</h3>
                        <p><strong>Applicable Legislation:</strong> ${getApplicableLegislation(study.country)}</p>
                        <p><strong>Current Arrangement:</strong> ${study.status}</p>
                        <p><strong>Compliance Focus:</strong> Cross-border data transfer regulations</p>
                    </div>

                    <div class="notification-section action-required">
                        <h3>üö® IMMEDIATE ACTION REQUIRED</h3>
                        <p><strong>Response Deadline:</strong> 5 Business Days (by ${deadlineStr})</p>
                        <p><strong>Required Confirmation:</strong></p>
                        <ul style="padding-left: 20px; margin-top: 10px;">
                            <li>Acknowledgment from ${study.country} and collaborating institutions</li>
                            <li>Agreement to proceed with DTA amendment</li>
                            <li>Confirmation of institutional review board notifications</li>
                        </ul>
                    </div>
                `;

                if (index < studies.length - 1) {
                    content += '<hr style="margin: 30px 0; border: none; border-top: 2px solid #eee;">';
                }
            });

            content += `
                <div class="notification-section">
                    <h3>üìû Project Management Contacts</h3>
                    <p><strong>Data Management:</strong> HEAT Center Team<br>
                    <strong>Legal Affairs:</strong> Legal Advisory Board<br>
                    <strong>Technical Support:</strong> Data Analysis Platform Team</p>
                </div>

                <div class="notification-section">
                    <h3>üìß Next Steps</h3>
                    <p>Please review the attached Data Management Plan v2.2 and respond within the specified deadline. For questions or clarifications, contact the HEAT Center project management team.</p>
                    <p><strong>Generated:</strong> ${currentDate}</p>
                </div>
            `;

            return content;
        }

        function getApplicableLegislation(country) {
            const legislation = {
                'Uganda': 'Uganda Data Protection and Privacy Act 2019',
                'Kenya': 'Kenya Data Protection Act 2019',
                'South Africa': 'Protection of Personal Information Act (POPIA) 2020',
                'Ethiopia': 'Ethiopian Data Protection Proclamation',
                'Ghana': 'Ghana Data Protection Act 2012',
                'Botswana': 'Botswana Data Protection Act 2018',
                'Malawi': 'Malawi Data Protection Act'
            };
            return legislation[country] || `${country} Data Protection Legislation`;
        }

        function copyNotification() {
            const content = document.getElementById('notificationContent').innerText;
            navigator.clipboard.writeText(content).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copied!';
                btn.style.background = '#28a745';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#28a745';
                }, 2000);
            });
        }

        function exportJson() {
            const data = JSON.stringify(allStudies, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'study_data.json';
            a.click();
        }

        function exportCsv() {
            const data = allStudies.map(study => {
                return [
                    study.code,
                    study.title,
                    study.country,
                    study.status,
                    study.type,
                    study.organization,
                    study.priority,
                    study.sample_size,
                    study.contact
                ].join(',');
            }).join('\n');
            const blob = new Blob([data], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'study_data.csv';
            a.click();
        }

        function toggleTheme() {
            document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>